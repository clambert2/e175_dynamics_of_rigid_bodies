NewtonianFrame N % Define non moving frame
RigidFrame A
RigidBody C, B % Define bodies for the shaft and rotor
Variable theta'', phi'', qC'' % Define all angles
% Constant Ixx, Iyy, Izz % Define all inertia quantities
Constant g, r, L % Defin all other constants 

% Set mass of C
C.SetMass(m)

% Rotations between frames
A.RotateZ(N, -theta) % Rotation between N and A frame
B.RotateX(A, -phi) % Rotation between A frame and B body
C.RotateZ(B, qC) % Rotation between B and C body

% Check angular velocity terms
w_A_N>
Express(w_B_N>, B)
Express(w_C_N>, B)

% Define location of Ccm
p_No_Ccm> = l*bz>

% Find the velocity of Ccm in N
Ccm.SetVelocity(N, No)

% Find the Inertia Dyadic of C about Ccm
C.SetInertia(Ccm, B, 0.25*m*r^2, 0.25*m*r^2, 0.5*m*r^2)
C.GetInertiaMatrix(Ccm, C) % Used to check that the intertia dyadic is correct

% Find the systems translational momentum
L_C_N> = m*v_Ccm_N>
IsLZero> = L_C_N> - C.GetLinearMomentum(N) % Check linear momentum calculation

% Find the systems angular momentum
H_C_Ccm_N> = Dot(I_C_Ccm>>, w_C_N>)
H_C_No_N> = H_C_Ccm_N> + Cross(p_No_Ccm>, L_C_N>)
Express(H_C_No_N>, B) % Express the angular momentum in terms of B
IsHZero> = H_C_No_N> - C.GetAngularMomentum(No) % Check angular momentum calculation

% Find the systems kinetic engergy
KE = 0.5*m*Dot(v_Ccm_N>, v_Ccm_N>) + 0.5*Dot(Dot(w_C_N>, I_C_Ccm>>), w_C_N>)
IsKEZero = KE - C.GetKineticEnergy() % Check kinetic energy calculation [Not working?]

% Formulate the time derivative of angular momentum in N
DT_H_C_No_N> = DT(H_C_No_N>, N)

% Find the external forces and moments on the system
F_Ccm_N> = -m*g*nz>
M_C_No_N> = Cross(p_No_Ccm>, F_Ccm_N>)

% Create equations for each rotation to solve for each angle
zero[1] = Dot(DT_H_C_No_N> - M_C_No_N>, nz>)
zero[2] = Dot(DT_H_C_No_N> - M_C_No_N>, ax>)
zero[3] = Dot(DT_H_C_No_N> - M_C_No_N>, bz>)

% Solve for each variable
Solve(zero, theta'', phi'', qC'')

% Plot and output the results in MATLAB
Input m = 0.1 kg, r = 0.2 m, L = 0.2 m, g = 9.8 m/s^2
Input qc = 0, qc' = 300 rpm
Input theta = 0 degrees, theta' = 0
Input phi = 20 degrees, phi' = 0
Input tFinal = 4, integStp = 0.05
OutputPlot t, theta
OutputPlot t, phi
ODE() hw_11_18_19.m
